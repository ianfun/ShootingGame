<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Clipboard</title>
</head>
<body>
    <h1>clipboard</h1>
    <div>
        <h2>copy from server</h2>
        <button onclick="copy_s()" disabled id="copy_btn">copy</button>
        <details>
            <summary>preview</summary>
            <pre id="preview"></pre>
        </details>

    </div>

    <div>
        <h2>paste to server</h2>
        <button onclick="paste_s()" id="paste_btn">paste</button>
    </div>
    <script>
        var s_text;
        var s_client;
        var copy_btn = document.getElementById('copy_btn');
        var paste_btn = document.getElementById('paste_btn');
        var preview = document.getElementById('preview');
        window.onload = function () {
            fetch('/').then(res => {
                res.text().then(t => {
                    s_text = t;
                    preview.innerText = s_text;
                    copy_btn.disabled = false;
                })
            })
        }
        function copy_a() {
            copy_btn.innerText = "copyed!";
            copy_btn.style.backgroundColor = 'green';
            setTimeout(() => {
                copy_btn.style.backgroundColor = '';
                copy_btn.innerText = "copy";
            }, 1000);
        }
        function copy_s() {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(s_text);
                copy_a();
            } else {
                var tmp = document.createElement('textarea');
                tmp.value = preview.innerText;
                tmp.focus();
                tmp.select();
                if (!document.execCommand('copy')) {
                    alert("Failed to copy:\ndocument.execCommand failed!");
                } else {
                    copy_a();
                }
            }
        }
        function paste_s() {
            if (!navigator.clipboard) {
                alert("Error:\ncannot paste to server beause your browser do not support `navigator.clipboard.readText`\nNote: navigator.clipboard require https:// url");
                return;
            }
            navigator.clipboard.readText().then(
                text => {
                    fetch('/',
                        {
                            method: "POST",
                            body: text
                        }
                    ).then(
                        res => {
                            if (res.ok) {
                                paste_btn.innerText = "pasted!";
                                paste_btn.style.backgroundColor = 'green';
                                setTimeout(() => {
                                    paste_btn.style.backgroundColor = '';
                                    paste_btn.innerText = "paste";
                                }, 1000);
                            }
                        }
                    ).catch(e => {
                        alert('Error:\nfailed to paste text to server:\n' + e);
                    })
                }
            )
        }
    </script>
</body>
</html>